
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Buttons: Callbacks vs. wasTriggered() &#8212; ICL Manual</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Evaluating Program Arguments" href="program-arguments.html" />
    <link rel="prev" title="GUI-Applications" href="gui-apps.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="program-arguments.html" title="Evaluating Program Arguments"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="gui-apps.html" title="GUI-Applications"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">ICL Manual</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../extras/tutorial.html" accesskey="U">Tutorials</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <script src="../js/jquery.tools.min.js"></script>

<div id="sticky">
  <table class="sticky-table">
  <tr><td><div class="sticky-entry "id="sticky-1"/><a class="sticky-link" href="../modules/utils.html">utils</a></td></tr>
  <tr><td><div class="sticky-entry "id="sticky-2"/><a class="sticky-link" href="../modules/math.html">math</a></td></tr>
  <tr><td><div class="sticky-entry "id="sticky-3"/><a class="sticky-link" href="../modules/core.html">core</a></td></tr>
  <tr><td><div class="sticky-entry "id="sticky-4"/><a class="sticky-link" href="../modules/filter.html">filter</a></td></tr>
  <tr><td><div class="sticky-entry "id="sticky-5"/><a class="sticky-link"href="../modules/io.html">io</a></td></tr>
  <tr><td><div class="sticky-entry "id="sticky-6"/><a class="sticky-link"href="../modules/qt.html">qt</a></td></tr>
  <tr><td><div class="sticky-entry "id="sticky-7"/><a class="sticky-link"href="../modules/cv.html">cv</a></td></tr>
  <tr><td><div class="sticky-entry "id="sticky-8"/><a class="sticky-link"href="../modules/geom.html">geom</a></td></tr>
  <tr><td><div class="sticky-entry "id="sticky-9"/><a class="sticky-link"href="../modules/markers.html">marker</a></td></tr>
  <tr><td><div class="sticky-entry "id="sticky-10"/><a class="sticky-link"href="../modules/physics.html">physics</a></td></tr>
  <!--tr><td><div class="sticky-entry "id="sticky-10"/><a class="sticky-link"href="../extras/tutorial.html">tutorial</a></td></tr-->
  </tr>
  </table>
</div>
<style type="text/css">
  .sticky-table{
     float: right;
  }

  a.sticky-link{
     color: inherit;
     font-size: 12px;
  }

  a.sticky-link:hover{
     text-decoration: none;
     color: inherit;
  }


  .sticky-entry{
     width: 12px;
     height: 12px;
     float: right;
     border-left: 1px solid rgb(200,200,200);
     border-top: 1px solid rgb(200,200,200);
     border-right: 1px solid rgb(100,100,100);
     border-bottom: 1px solid rgb(100,100,100);

     border-radius: 4px;
     box-shadow: 2px 2px 5px rgba(0,0,0,0.6);
     border: 1px solid blue;
     background-color: transparent; /* white; */
     color: transparent;
  }
  .sticky-entry:hover{
     width: 40px;
     color: rgb(100,100,100);
     background-color: white;
     padding-left: 2px;
     box-shadow: 5px 5px 10px rgba(0,0,0,0.6);
  }
  .sticky-entry:active{
     box-shadow: 0px 0px 0px transparent;
     border-left: 1px solid rgb(70,70,70);
     border-top: 1px solid rgb(70,70,70);
     border-right: 1px solid white;
     border-bottom: 1px solid white;
  }

  #sticky-1{ border: 1px solid rgb(255,0,255); }
  #sticky-2{ border: 1px solid rgb(255,0,0); }
  #sticky-3{ border: 1px solid rgb(255,128,0); }
  #sticky-4{ border: 1px solid rgb(255,255,0); }
  #sticky-5{ border: 1px solid rgb(168,255,0); }
  #sticky-6{ border: 1px solid rgb(0,200,255); }
  #sticky-7{ border: 1px solid rgb(0,255,0); }
  #sticky-8{ border: 1px solid rgb(0,50,255); }
  #sticky-9{ border: 1px solid rgb(0,0,255); }
  #sticky-10{ border: 1px solid rgb(128,0,255); }

  #sticky{
    line-height: 8px;
    margin-left:auto;
    position:absolute;
    right:0px;
    top:100px;
    padding:2px;
    padding-right:0px;
    padding-left:1px;
    position: fixed;
    background: transparent url(../_static/images/dash.png);
    width: 33px;
    height: 193px;
    top: 99px;
    padding-top: 12px;
  }

</style>

<script type="text/javascript">

$('#sticky-1').bind('click',function(e){ location = '../modules/utils.html';  });
$('#sticky-2').bind('click',function(e){ location = '../modules/math.html';  });
$('#sticky-3').bind('click',function(e){ location = '../modules/core.html';  });
$('#sticky-4').bind('click',function(e){ location = '../modules/filter.html';  });
$('#sticky-5').bind('click',function(e){ location = '../modules/io.html';  });
$('#sticky-6').bind('click',function(e){ location = '../modules/cv.html';  });
$('#sticky-7').bind('click',function(e){ location = '../modules/qt.html';  });
$('#sticky-8').bind('click',function(e){ location = '../modules/geom.html';  });
$('#sticky-9').bind('click',function(e){ location = '../modules/markers.html';  });
$('#sticky-10').bind('click',function(e){ location = '../modules/physics.html.html';  });

/* Script by: www.jtricks.com
 * Version: 20071127
 * Latest version:
 * www.jtricks.com/javascript/navigation/fixed_menu.html
 */
fixedMenuId = 'sticky';

var fixedMenu = {
    hasInner: typeof(window.innerWidth) == 'number',
    hasElement: document.documentElement != null
       && document.documentElement.clientWidth,

    menu: document.getElementById
        ? document.getElementById(fixedMenuId)
        : document.all
          ? document.all[fixedMenuId]
          : document.layers[fixedMenuId]
};

fixedMenu.computeShifts = function(){
    fixedMenu.shiftX = fixedMenu.hasInner
        ? pageXOffset
        : fixedMenu.hasElement
          ? document.documentElement.scrollLeft
          : document.body.scrollLeft;
    if (fixedMenu.targetLeft > 0){
        fixedMenu.shiftX += fixedMenu.targetLeft;
    }else{
        fixedMenu.shiftX +=
            (fixedMenu.hasElement
              ? document.documentElement.clientWidth
              : fixedMenu.hasInner
                ? window.innerWidth - 20
                : document.body.clientWidth)
            - fixedMenu.targetRight
            - fixedMenu.menu.offsetWidth;
    }

    fixedMenu.shiftY = fixedMenu.hasInner
        ? pageYOffset
        : fixedMenu.hasElement
          ? document.documentElement.scrollTop
          : document.body.scrollTop;
    if (fixedMenu.targetTop > 0){
        fixedMenu.shiftY += fixedMenu.targetTop;
    }else{
        fixedMenu.shiftY +=
            (fixedMenu.hasElement
            ? document.documentElement.clientHeight
            : fixedMenu.hasInner
              ? window.innerHeight - 20
              : document.body.clientHeight)
            - fixedMenu.targetBottom
            - fixedMenu.menu.offsetHeight;
    }
};

fixedMenu.moveMenu = function(){
    fixedMenu.computeShifts();

    if (fixedMenu.currentX != fixedMenu.shiftX
        || fixedMenu.currentY != fixedMenu.shiftY){
        fixedMenu.currentX = fixedMenu.shiftX;
        fixedMenu.currentY = fixedMenu.shiftY;

        if (document.layers){
            fixedMenu.menu.left = fixedMenu.currentX;
            fixedMenu.menu.top = fixedMenu.currentY;
        }else{
            fixedMenu.menu.style.left = fixedMenu.currentX + 'px';
            fixedMenu.menu.style.top = fixedMenu.currentY + 'px';
        }
    }

    fixedMenu.menu.style.right = '';
    fixedMenu.menu.style.bottom = '';
};

fixedMenu.floatMenu = function(){
    fixedMenu.moveMenu();
    setTimeout('fixedMenu.floatMenu()', 20);
};

// addEvent designed by Aaron Moore
fixedMenu.addEvent = function(element, listener, handler){
    if(typeof element[listener] != 'function' ||
       typeof element[listener + '_num'] == 'undefined'){
        element[listener + '_num'] = 0;
        if (typeof element[listener] == 'function'){
            element[listener + 0] = element[listener];
            element[listener + '_num']++;
        }
        element[listener] = function(e){
            var r = true;
            e = (e) ? e : window.event;
            for(var i = 0; i < element[listener + '_num']; i++)
                if(element[listener + i](e) === false)
                    r = false;
            return r;
        }
    }

    //if handler is not already stored, assign it
    for(var i = 0; i < element[listener + '_num']; i++)
        if(element[listener + i] == handler)
            return;
    element[listener + element[listener + '_num']] = handler;
    element[listener + '_num']++;
};

fixedMenu.supportsFixed = function(){
    var testDiv = document.createElement("div");
    testDiv.id = "testingPositionFixed";
    testDiv.style.position = "fixed";
    testDiv.style.top = "0px";
    testDiv.style.right = "0px";
    document.body.appendChild(testDiv);
    var offset = 1;
    if (typeof testDiv.offsetTop == "number"
        && testDiv.offsetTop != null
        && testDiv.offsetTop != "undefined")
    {
        offset = parseInt(testDiv.offsetTop);
    }
    if (offset == 0)
    {
        return true;
    }

    return false;
};

fixedMenu.init = function(){
    if (fixedMenu.supportsFixed())
        fixedMenu.menu.style.position = "fixed";
    else
    {
        var ob =
            document.layers
            ? fixedMenu.menu
            : fixedMenu.menu.style;

        fixedMenu.targetLeft = parseInt(ob.left);
        fixedMenu.targetTop = parseInt(ob.top);
        fixedMenu.targetRight = parseInt(ob.right);
        fixedMenu.targetBottom = parseInt(ob.bottom);

        if (document.layers)
        {
            menu.left = 0;
            menu.top = 0;
        }
        fixedMenu.addEvent(window, 'onscroll', fixedMenu.moveMenu);
        fixedMenu.floatMenu();
    }
};

fixedMenu.addEvent(window, 'onload', fixedMenu.init);

jQuery(document).ready(function() {

  console.log('executing java-script-based document upgrade');

  $('.reference.external').after(function() {

    this.href = this.href.replace('doc/icl-manual/doc/icl-api/','doc/icl-api/');

    var href = this.href;
    var text = this.text;

    var package = 'unknown';
    var type = 'other';

    if( this.text.match('^ICL.*\.h$') ){ // we have a header file
       var m = this.text.match('ICL(\[^/\]*)/.*');
       if( m ){
          package = m[1].toLowerCase();
          type = "header";
       }
    }else if(this.text.match('.*\.h$')){
       package  = 'unknown';
       type = "header";
    }


    var packages = [ 'utils', 'math', 'core', 'filter', 'io', 'qt', 'cv', 'geom', 'markers', 'physics' ];
    var groupLUT = [ ['TIME', 'EXCEPT', 'THREAD', 'RANDOM', 'UTILS' , 'PA', 'XML', 'STRUTILS', 'FUNCTION', 'BASIC__TYPES'],
                     ['LINALG'],
                     ['TYPES', 'GENERAL', 'IMAGE'],
                     ['UNARY', 'BINARY', 'AFFINE', 'NBH', 'INPLACE' ],
                     ['DC_G', 'UTILS_G', 'FILEIO_G', 'MOVIE_FILE_G', 'V4L_G', 'GIGE_G'],
                     ['COMMON', 'HANDLES', 'UNCOMMON'],
                     ['G_RD'],
                     [],
                     ['PLUGINS']
                   ];

    if(package == 'unknown'){
      for(var i=0;i<10;++i){
        if( href.match('.*/namespaceicl_1_1'+packages[i]+'\.html') ){
          package = packages[i];
          // could be a function or a namespace
          if(this.text.match('.*'+packages[i]+'$')){
             type = 'namespace';
          }else if(this.text[0] > 'A' && this.text[0] < 'Z'){
             type = 'global type';
          }else{
             type = 'global function';
          }
          break;
        }
        if( href.match('.*icl_1_1'+packages[i]+'.*') ){
          package = packages[i];
          break;
        }
      }
    }
    if(package == 'unknown'){
      var res = href.match('.*group__(\[^.\]*).*')
      if( res ){
         var groupName = res[1];
         for(var i=0;i<9;++i){
            if(groupLUT[i].indexOf(groupName) != -1){
                package = packages[i];
                break;
            }
         }
         var res2 = this.text.match('.*::(\[^:\]*)$');
         var t = "???";
         if(res2){
            t = res2[1];
         }else{
            t = this.text;
         }
         if(t[0] > 'A' && t[0] < 'Z'){
            type = "grouped type";
         }else{
            if(groupName == "TYPES"){
              type = "core type";
            }else if(groupName == "BASIC__TYPES"){
              type = "basic type";
            }else{
              type = "grouped func.";
            }
         }
       }
    }

    if(href.match('.*classicl.*')){
       if(href.match('.*#\[0-9a-f\]*')){
         type = 'class: method';
       }else{
         type = 'class';
       }
    }else if(href.match('.*structicl.*')){
       if(href.match('.*#\[0-9a-f\]*')){
         type = 'struct: method';
       }else{
         type = 'struct';
       }
    }
    if(package == "unknown" && href.match('.*namespaceicl.*')){
      // very special treatment
      return '<div class="tooltip">the <b>icl</b> namespace is used for all '
            +'modules.</div>';

    }else if(package != "unknown"){
      return '<div class="tooltip">'
         + '<a href="../modules/'+package+'.html">'
         + '<img title="manual: '+package+' module" width="110px" src="../_images/'+package+'1.png"></img>'
         + '</a>'
         + '<br/>' + 'Type:   <b>' + type + '</b>'
         + '</div>';
    }else{
      return '<div class="tooltip">'
         + 'Unable to locate package'
         + '<br/>' + 'Type:   <b>' + type + '</b>'
         + '</div>';
    }

    //return '<div class="tooltip">' + 'TEST TEST TEST' + '</div>';
  });

  $('.reference.external').tooltip({
    position: "top center",
    opacity: 0.95,
    effect: 'fade',
    offset: [7,33]
  });

});
</script>
<style type="text/css">

  .tooltip {
    display:none;
    background: transparent url(../_static/images/tooltip.png);
    font-size:13px;
    height:80px;
    width:131px;
    padding:10px;
    color: #555;
    line-height: 20px;
  }
  a.reference.external {
    color: rgb(20,60,100);
    padding: 2px;
    padding-left: 6px;
    padding-right: 5px;
  }
  a.reference.external:hover {
    color: rgb(20,60,100);
    border: 1px solid rgba(0,0,0,0.3);
    border-radius: 5px;
    box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
    padding: 2px;
    padding-left: 5px;
    padding-right: 4px;
    text-decoration: none;
  }

 div.body{
    border-top-left-radius: 15px;
    border-bottom-left-radius: 15px;
    border: 1px solid rgb(110,110,110);
    box-shadow: 0px 0px 50px rgba(0,0,0,0.7);
  }

  div.body h1{
    border-top-left-radius: 15px;
    box-shadow: 0px 2px 0px rgba(0,0,0,0.4);
  }


  div.body h1, div.body h2, div.body h3, div.body h4{
    margin-bottom: -8px;
    background-repeat: no-repeat;
    margin-left: -41px;
    box-shadow: none;
    border: none;
    opacity: 1;
    color: rgb(230,230,230);
    height: 44px;
    padding-top: 4px;
  }

  div.body h1{
    padding-top: 7px;
    background: transparent url(../_static/images/h1.png);
    margin-top: 8px;
    border-radius: 0px;
    height: 57px;
    padding-top: 3px;
  }

  div.body h2{
    padding-top: 7px;
    background: transparent url(../_static/images/h2.png);
    height: 52px;
  }

  div.body h3{
    background: transparent url(../_static/images/h3.png);
  }

  div.body h4{
    padding-top: 5px;
    height: 42px;
    background: transparent url(../_static/images/h4.png);
    color: rgb(60,60,60);
  }

  div.sphinxsidebar{
    font-size: 80%;
  }

  table.docutils td, table.docutils th{
    border: 0px;
  }
  th {
     background-color: #0F67A1;
     color: rgb(220,220,220);
  }

  img[alt="shadow"]{
     box-shadow: 5px 5px 12px rgba(0,0,0,0.3);
  }

  a.headerlink {
     color: rgb(230,230,230);
  }
  a.headerlink:hover{
     color: white;
     background: transparent;
  }

  h4:hover > a.headerlink {
     color: rgb(60,60,60);
  }
  h4 > a.headerlink {
     color: rgb(90,90,90);
  }
  div.related ul{
     background: rgba(60, 60, 60, 0);
     background-image: url(../_static/images/stripes3.png);
     background-position-x: 2px;
  }
  div.documentwrapper, div.footer {
     background-image: url(../_static/images/stripes1.png);
  }

  img.logo{
     background-color: white;
     border-radius: 8px;
     border: 1px solid #A0A0A0;
     box-shadow: 5px 5px 20px rgba(0,0,0,0.4);
     padding: 8px;
  }

  div.sphinxsidebar #searchbox input[type="text"] {
     width: 160px;
  }

</style><div class="section" id="buttons-callbacks-vs-wastriggered">
<span id="tut-buttons"></span><h1>Buttons: Callbacks vs. wasTriggered()<a class="headerlink" href="#buttons-callbacks-vs-wastriggered" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="../icl-api/structicl_1_1qt_1_1Button.html">Button</a> component behaves slightly different from most of
the other components. If we consider a slider, that is used to adjust
a certain value, it is completely clear, how this value, even though
it is adapted in the application’s GUI thread, can be accessed in the
working thread. Here, our implementation will just keep a registered
<strong>int</strong> variable up to date, whose value is returned when the slider
value is queried from the <a class="reference external" href="../icl-api/classicl_1_1qt_1_1GUI.html">GUI</a> instance. In contrast, a button
usually triggers some kind of event. However, we can not simply
register a callback to the buttons <em>click</em> event, since the callback
would then be executed in the GUI thread, leaving the user all the
extra work for explicit synchronization with the application’s working
thread.</p>
<p>Actually, in some special situations, a callback registration is
exactly what we want, in particular, if e.g. a button-click affects
some other Qt-GUI components directly. For this, the <a class="reference external" href="../icl-api/classicl_1_1qt_1_1GUI.html">GUI</a> class
provides the ability to register callbacks to nearly all components.</p>
<p>However, as introduced above, most of the time, a button-click is not
to be executed immediately, but the next time, the working-thread run
through. For this purpose the button-component’s handle class
<a class="reference external" href="../icl-api/classicl_1_1qt_1_1ButtonHandle.html">ButtonHandle</a> provides the
<a class="reference external" href="../icl-api/classicl_1_1qt_1_1ButtonHandle.html#a7a80707edccbd35929654fa28311d99d">wasTriggered</a> method, that returns
true if the button was pressed since the method was called before.</p>
<div class="section" id="a-simple-example">
<h2>A Simple Example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h2>
<p>Lets just implement a simple image processing application, that
applies one of the morphological operators provided by ICL in
real-time on a given input image. The application has three buttons:</p>
<ol class="arabic simple">
<li>use next filter</li>
<li>save current result image</li>
<li>show an extra GUI for the input image</li>
</ol>
<p>For the the buttons 1 and 2 we will use the <a class="reference external" href="../icl-api/classicl_1_1qt_1_1ButtonHandle.html">ButtonHandle</a> and
its <a class="reference external" href="../icl-api/classicl_1_1qt_1_1ButtonHandle.html#a7a80707edccbd35929654fa28311d99d">wasTriggered</a> method. Since
button 3  affects a Qt-GUI component, we will use the callback
mechanism for this.</p>
<table border="1" class="docutils">
<colgroup>
<col width="55%" />
<col width="45%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="first last highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ICLQt/Common.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ICLFilter/MorphologicalOp.h&gt;</span><span class="cp"></span>

<span class="n">HSplit</span> <span class="n">gui</span><span class="p">;</span>
<span class="n">GUI</span> <span class="n">input</span><span class="p">;</span>
<span class="n">GenericGrabber</span> <span class="n">grabber</span><span class="p">;</span>
<span class="n">MorphologicalOp</span> <span class="n">op</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">currFilter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">init</span><span class="p">(){</span>
  <span class="n">grabber</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">pa</span><span class="p">(</span><span class="s">&quot;-i&quot;</span><span class="p">));</span>
  <span class="n">gui</span> <span class="o">&lt;&lt;</span> <span class="n">Image</span><span class="p">().</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;result&quot;</span><span class="p">)</span>
      <span class="o">&lt;&lt;</span> <span class="p">(</span> <span class="n">VBox</span><span class="p">()</span>
           <span class="o">&lt;&lt;</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;next filter&quot;</span><span class="p">).</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;next&quot;</span><span class="p">)</span>
           <span class="o">&lt;&lt;</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;save&quot;</span><span class="p">).</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;save&quot;</span><span class="p">)</span>
           <span class="o">&lt;&lt;</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;show src&quot;</span><span class="p">).</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;show&quot;</span><span class="p">)</span>
           <span class="p">)</span>
      <span class="o">&lt;&lt;</span> <span class="n">Show</span><span class="p">();</span>

  <span class="n">input</span> <span class="o">&lt;&lt;</span> <span class="n">Image</span><span class="p">().</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;image&quot;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">Create</span><span class="p">();</span>

  <span class="n">gui</span><span class="p">[</span><span class="s">&quot;show&quot;</span><span class="p">].</span><span class="n">registerCallback</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span>
                      <span class="o">&amp;</span><span class="n">GUI</span><span class="o">::</span><span class="n">switchVisibility</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">run</span><span class="p">(){</span>
  <span class="k">static</span> <span class="n">ButtonHandle</span> <span class="n">next</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&quot;next&quot;</span><span class="p">];</span>
  <span class="k">static</span> <span class="n">ButtonHandle</span> <span class="n">save</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&quot;save&quot;</span><span class="p">];</span>

  <span class="k">const</span> <span class="n">ImgBase</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="n">grabber</span><span class="p">.</span><span class="n">grab</span><span class="p">();</span>

  <span class="k">if</span><span class="p">(</span><span class="n">next</span><span class="p">.</span><span class="n">wasTriggered</span><span class="p">()){</span>
    <span class="n">currFilter</span> <span class="o">=</span> <span class="p">(</span><span class="n">currFilter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">10</span><span class="p">;</span>
    <span class="n">op</span><span class="p">.</span><span class="n">setOptype</span><span class="p">((</span><span class="n">MorphologicalOp</span><span class="o">::</span><span class="n">optype</span><span class="p">)</span><span class="n">currFilter</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">const</span> <span class="n">ImgBase</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="n">op</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>

  <span class="n">gui</span><span class="p">[</span><span class="s">&quot;result&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">isVisible</span><span class="p">()){</span>
    <span class="n">input</span><span class="p">[</span><span class="s">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">save</span><span class="p">.</span><span class="n">wasTriggered</span><span class="p">()){</span>
    <span class="n">qt</span><span class="o">::</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">,</span><span class="s">&quot;current-image.png&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">args</span><span class="p">){</span>
   <span class="k">return</span> <span class="n">ICLApp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">args</span><span class="p">,</span><span class="s">&quot;-input|-i(2)&quot;</span><span class="p">,</span><span class="n">init</span><span class="p">,</span><span class="n">run</span><span class="p">).</span><span class="n">exec</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</td>
<td><p class="first"><strong>main GUI</strong></p>
<blockquote>
<div><img alt="shadow" src="../_images/gui-buttons-1.png" />
</div></blockquote>
<p><strong>extra GUI</strong></p>
<blockquote>
<div><img alt="shadow" src="../_images/gui-buttons-2.png" />
</div></blockquote>
<p>started with:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">example</span> <span class="o">-</span><span class="nb">input</span> <span class="n">create</span> <span class="n">cameraman</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="section" id="step-by-step">
<h3>Step by Step<a class="headerlink" href="#step-by-step" title="Permalink to this headline">¶</a></h3>
<p>After including the prototyping header
<a class="reference external" href="../icl-api/Common_8h.html">ICLQt/Common.h</a>, and the header for the
<a class="reference external" href="../icl-api/classicl_1_1filter_1_1MorphologicalOp.html">filter::MorphologicalOp</a> that is used, the static application
data is declared.  We use two GUI instances, one of the
<a class="reference external" href="../icl-api/classicl_1_1qt_1_1GUI.html">GUI</a>-subclass <a class="reference external" href="../icl-api/structicl_1_1qt_1_1HSplit.html">HSplit</a>. Furthermore, a
<a class="reference external" href="../icl-api/classicl_1_1io_1_1GenericGrabber.html">GenericGrabber</a> is used for image acquisition and a
simple integer variable for the current morphological filter type.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ICLQt/Common.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ICLFilter/MorphologicalOp.h&gt;</span><span class="cp"></span>

<span class="n">HSplit</span> <span class="n">gui</span><span class="p">;</span>
<span class="n">GUI</span> <span class="n">input</span><span class="p">;</span>
<span class="n">GenericGrabber</span> <span class="n">grabber</span><span class="p">;</span>
<span class="n">MorphologicalOp</span> <span class="n">op</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">currFilter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>As usual, the application uses the default <strong>init</strong> – <strong>run</strong> –
<strong>main</strong> combination. In <strong>init</strong>, we first initialize the
<a class="reference external" href="../icl-api/classicl_1_1io_1_1GenericGrabber.html">GenericGrabber</a> instance by linking it to our program argument
“-input”. Now, two seperate <a class="reference external" href="../icl-api/classicl_1_1qt_1_1GUI.html">GUI</a> instances are to be created:
our main GUI called <strong>gui</strong> and a simple extra GUI for the optional
visualization of input images, called <strong>input</strong>. The main
<a class="reference external" href="../icl-api/structicl_1_1qt_1_1HSplit.html">HSplit</a> GUI is filled with two sub-components, an <a class="reference external" href="../icl-api/structicl_1_1qt_1_1Image.html">Image</a>
for the visualization of the result images and an extra <a class="reference external" href="../icl-api/structicl_1_1qt_1_1VBox.html">VBox</a>
container for the buttons, each set up with a unique handle for later
access. The GUI is immediately created and shown by streaming a
<a class="reference external" href="../icl-api/structicl_1_1qt_1_1Show.html">Show</a>-instance at the end of the GUI definition expression.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">init</span><span class="p">(){</span>
  <span class="n">grabber</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">pa</span><span class="p">(</span><span class="s">&quot;-i&quot;</span><span class="p">));</span>
  <span class="n">gui</span> <span class="o">&lt;&lt;</span> <span class="n">Image</span><span class="p">().</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;result&quot;</span><span class="p">)</span>
      <span class="o">&lt;&lt;</span> <span class="p">(</span> <span class="n">VBox</span><span class="p">()</span>
           <span class="o">&lt;&lt;</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;next filter&quot;</span><span class="p">).</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;next&quot;</span><span class="p">)</span>
           <span class="o">&lt;&lt;</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;save&quot;</span><span class="p">).</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;save&quot;</span><span class="p">)</span>
           <span class="o">&lt;&lt;</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;show src&quot;</span><span class="p">).</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;show&quot;</span><span class="p">)</span>
           <span class="p">)</span>
      <span class="o">&lt;&lt;</span> <span class="n">Show</span><span class="p">();</span>
</pre></div>
</div>
<p>The <strong>input</strong>-GUI is only filled with a simple extra image
visualization component. Here, we use <a class="reference external" href="../icl-api/structicl_1_1qt_1_1Create.html">Create</a> instead of
<a class="reference external" href="../icl-api/structicl_1_1qt_1_1Show.html">Show</a>, which creates the GUI without directly showing it.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="n">input</span> <span class="o">&lt;&lt;</span> <span class="n">Image</span><span class="p">().</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;image&quot;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">Create</span><span class="p">();</span>
</pre></div>
</div>
<p>Finally, we register a callback to the “show src” Button. This is
necessary because we cannot affect Qt-Windows and Widgets from the
applications working thread. Registered callbacks are always processed
in the GUI thread, where this is allowed. We simply create an
anonymous member function here, that changes the <strong>input</strong> GUI’s
<em>visible</em>-flag at each klick.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="n">gui</span><span class="p">[</span><span class="s">&quot;show&quot;</span><span class="p">].</span><span class="n">registerCallback</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span>
                      <span class="o">&amp;</span><span class="n">GUI</span><span class="o">::</span><span class="n">switchVisibility</span><span class="p">));</span>
</pre></div>
</div>
<p>Once, the initialization is finished, the run method is
implemented. Here, we first extract two <a class="reference external" href="../icl-api/classicl_1_1qt_1_1ButtonHandle.html">ButtonHandle</a> instances
from the applications main GUI. These are later used for the
<a class="reference external" href="../icl-api/classicl_1_1qt_1_1ButtonHandle.html#a7a80707edccbd35929654fa28311d99d">wasTriggered()</a>-mechanism.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="k">static</span> <span class="n">ButtonHandle</span> <span class="n">next</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&quot;next&quot;</span><span class="p">];</span>
  <span class="k">static</span> <span class="n">ButtonHandle</span> <span class="n">save</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&quot;save&quot;</span><span class="p">];</span>
</pre></div>
</div>
<p>Now, the actual image processing loop is implemented. The next
image is acquired form the <a class="reference external" href="../icl-api/classicl_1_1io_1_1GenericGrabber.html">GenericGrabber</a> instance. Before
the morphological operator is applied to the input image, we check
whether the <em>next filter</em> button has been pressed since the last
loop cycle.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="k">const</span> <span class="n">ImgBase</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="n">grabber</span><span class="p">.</span><span class="n">grab</span><span class="p">();</span>

  <span class="k">if</span><span class="p">(</span><span class="n">next</span><span class="p">.</span><span class="n">wasTriggered</span><span class="p">()){</span>
    <span class="n">currFilter</span> <span class="o">=</span> <span class="p">(</span><span class="n">currFilter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">10</span><span class="p">;</span>
    <span class="n">op</span><span class="p">.</span><span class="n">setOptype</span><span class="p">((</span><span class="n">MorphologicalOp</span><span class="o">::</span><span class="n">optype</span><span class="p">)</span><span class="n">currFilter</span><span class="p">);</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>If this is true, the next valid <a class="reference external" href="../icl-api/classicl_1_1filter_1_1MorphologicalOp.html#ac7ae72cd417ffdb16731ec94d8b3355e">MorphologicalOp::optype</a> value
is estimated and used to set up our operator. Now, the filter is applied
and the result image can be visualized.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="k">const</span> <span class="n">ImgBase</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="n">op</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>

  <span class="n">gui</span><span class="p">[</span><span class="s">&quot;result&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">;</span>
</pre></div>
</div>
<p>Only if the <strong>input</strong>-GUI is visible, the source image is visualized
as well. This is not completely necessary, but leads to a cheap
optimization in case of the <strong>input</strong>-GUI is not visible, because the
image data must not be transferred to the GUI-thread in this case.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="k">if</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">isVisible</span><span class="p">()){</span>
    <span class="n">input</span><span class="p">[</span><span class="s">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>Finally, we check the <strong>save</strong>-button. If this was triggered, the
current result image is saved.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="k">if</span><span class="p">(</span><span class="n">save</span><span class="p">.</span><span class="n">wasTriggered</span><span class="p">()){</span>
    <span class="n">qt</span><span class="o">::</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">,</span><span class="s">&quot;current-image.png&quot;</span><span class="p">);</span>
  <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is very important to know, that we cannot make use of a Qt-Dialog
here to ask the user for a desired file-name. If a GUI-based dialog is
to be used, this step has to be transferred to the GUI-thread by using
a GUI callback for this button as well.</p>
</div>
</div>
<div class="section" id="gui-dialogs">
<h3>GUI-Dialogs<a class="headerlink" href="#gui-dialogs" title="Permalink to this headline">¶</a></h3>
<p>As motivated and discussed before, GUI-Dialogs can only be
instantiated in the application’s GUI thread, but not in the working
thread. However, if dialogs processed in the GUI-thread by using the
<a class="reference external" href="../icl-api/classicl_1_1qt_1_1GUI.html">GUI</a>’s callback mechanism, temporary values from the working thread
cannot be accessed directly.</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ICLQt/Common.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ICLFilter/MorphologicalOp.h&gt;</span><span class="cp"></span>

<span class="n">HSplit</span> <span class="n">gui</span><span class="p">;</span>
<span class="n">GUI</span> <span class="n">input</span><span class="p">;</span>
<span class="n">GenericGrabber</span> <span class="n">grabber</span><span class="p">;</span>
<span class="n">MorphologicalOp</span> <span class="n">op</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">currFilter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="n">Mutex</span> <span class="n">resultMutex</span><span class="p">;</span>
<span class="n">ImgBase</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">saveImage</span><span class="p">(){</span>
  <span class="k">try</span><span class="p">{</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">filename</span> <span class="o">=</span> <span class="n">saveFileDialog</span><span class="p">();</span>
    <span class="n">Mutex</span><span class="o">::</span><span class="n">Locker</span> <span class="n">lock</span><span class="p">(</span><span class="n">resultMutex</span><span class="p">);</span>
    <span class="n">qt</span><span class="o">::</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span>
  <span class="p">}</span><span class="k">catch</span><span class="p">(...){}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">init</span><span class="p">(){</span>
  <span class="n">grabber</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">pa</span><span class="p">(</span><span class="s">&quot;-i&quot;</span><span class="p">));</span>
  <span class="n">gui</span> <span class="o">&lt;&lt;</span> <span class="n">Image</span><span class="p">().</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;result&quot;</span><span class="p">)</span>
      <span class="o">&lt;&lt;</span> <span class="p">(</span> <span class="n">VBox</span><span class="p">()</span>
           <span class="o">&lt;&lt;</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;next filter&quot;</span><span class="p">).</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;next&quot;</span><span class="p">)</span>
           <span class="o">&lt;&lt;</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;save&quot;</span><span class="p">).</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;save&quot;</span><span class="p">)</span>
           <span class="o">&lt;&lt;</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;show src&quot;</span><span class="p">).</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;show&quot;</span><span class="p">)</span>
           <span class="p">)</span>
      <span class="o">&lt;&lt;</span> <span class="n">Show</span><span class="p">();</span>

  <span class="n">input</span> <span class="o">&lt;&lt;</span> <span class="n">Image</span><span class="p">().</span><span class="n">handle</span><span class="p">(</span><span class="s">&quot;image&quot;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">Create</span><span class="p">();</span>

  <span class="n">gui</span><span class="p">[</span><span class="s">&quot;show&quot;</span><span class="p">].</span><span class="n">registerCallback</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span>
                      <span class="o">&amp;</span><span class="n">GUI</span><span class="o">::</span><span class="n">switchVisibility</span><span class="p">));</span>

  <span class="n">gui</span><span class="p">[</span><span class="s">&quot;save&quot;</span><span class="p">].</span><span class="n">registerCallback</span><span class="p">(</span><span class="n">saveImage</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">run</span><span class="p">(){</span>
  <span class="k">static</span> <span class="n">ButtonHandle</span> <span class="n">next</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&quot;next&quot;</span><span class="p">];</span>
  <span class="k">const</span> <span class="n">ImgBase</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="n">grabber</span><span class="p">.</span><span class="n">grab</span><span class="p">();</span>

  <span class="k">if</span><span class="p">(</span><span class="n">next</span><span class="p">.</span><span class="n">wasTriggered</span><span class="p">()){</span>
    <span class="n">currFilter</span> <span class="o">=</span> <span class="p">(</span><span class="n">currFilter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">10</span><span class="p">;</span>
    <span class="n">op</span><span class="p">.</span><span class="n">setOptype</span><span class="p">((</span><span class="n">MorphologicalOp</span><span class="o">::</span><span class="n">optype</span><span class="p">)</span><span class="n">currFilter</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">resultMutex</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
  <span class="n">op</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="o">&amp;</span><span class="n">result</span><span class="p">);</span>
  <span class="n">resultMutex</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>

  <span class="n">gui</span><span class="p">[</span><span class="s">&quot;result&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">isVisible</span><span class="p">()){</span>
    <span class="n">input</span><span class="p">[</span><span class="s">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">args</span><span class="p">){</span>
   <span class="k">return</span> <span class="n">ICLApp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">args</span><span class="p">,</span><span class="s">&quot;-input|-i(2)&quot;</span><span class="p">,</span><span class="n">init</span><span class="p">,</span><span class="n">run</span><span class="p">).</span><span class="n">exec</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>As we can see, only a few changes were to be made here. First of all,
we use a global result image instance here that is protected by a
<a class="reference external" href="../icl-api/classicl_1_1utils_1_1Mutex.html">Mutex</a> instance.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Mutex</span> <span class="n">resultMutex</span><span class="p">;</span>
<span class="n">ImgBase</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>Furthermore, we add an extra <strong>saveImage</strong> function, that is linked as
a callback to the button click event. The function uses the simple to
used <span>qt::saveFileDialog()</span> function, that simply wraps a Qt file
dialog. Its call is set into a <strong>try-catch</strong> block to react to the
case if the user presses the <em>cancel</em> or the <em>window-close</em> button in
this dialog. If a valid image file name was provided, the result image
mutex is locked (here using a scoped lock of type
<a class="reference external" href="../icl-api/classicl_1_1utils_1_1Mutex_1_1Locker.html">Mutex::Locker</a>) and the current result image can be saved just
like in the former example. Moving the scoped lock on top of the call
to <a class="reference external" href="../icl-api/namespaceicl_1_1qt.html#adbe029f01c2d4ea8f82a89d844c05b9d">qt::saveFileDialog</a> would suspend the working thread while
the user selects a file name, which is usually more practical.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">saveImage</span><span class="p">(){</span>
  <span class="k">try</span><span class="p">{</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">filename</span> <span class="o">=</span> <span class="n">saveFileDialog</span><span class="p">();</span>
    <span class="n">Mutex</span><span class="o">::</span><span class="n">Locker</span> <span class="n">lock</span><span class="p">(</span><span class="n">resultMutex</span><span class="p">);</span>
    <span class="n">qt</span><span class="o">::</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span>
  <span class="p">}</span><span class="k">catch</span><span class="p">(...){}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the <strong>init</strong> method, we only need to register an extra callback:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="n">gui</span><span class="p">[</span><span class="s">&quot;save&quot;</span><span class="p">].</span><span class="n">registerCallback</span><span class="p">(</span><span class="n">saveImage</span><span class="p">);</span>
</pre></div>
</div>
<p>In <strong>run</strong>, we no longer need to handle the <strong>save</strong> button
explicitly.  Instead, we have to use the global <strong>result</strong>-image, to
make it accessible from the GUI-thread as well. While the new result
image is created, we lock the corresponding <a class="reference external" href="../icl-api/classicl_1_1utils_1_1Mutex.html">Mutex</a> variable in
order to avoid that the image is saved while it is updated by the
working thread. Without the locking mechanism, the image could either
be reallocated by the morphological operator, which would lead to a
possible <em>segmentation fault</em> in the <strong>saveImage</strong> callback
function. But also if the image data is not reallocated, <strong>saveImage</strong>
would not be synchronized with the working thread and therefore
possibly save have-adapted images.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  <span class="n">resultMutex</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
  <span class="n">op</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="o">&amp;</span><span class="n">result</span><span class="p">);</span>
  <span class="n">resultMutex</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Buttons: Callbacks vs. wasTriggered()</a><ul>
<li><a class="reference internal" href="#a-simple-example">A Simple Example</a><ul>
<li><a class="reference internal" href="#step-by-step">Step by Step</a></li>
<li><a class="reference internal" href="#gui-dialogs">GUI-Dialogs</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="gui-apps.html"
                        title="previous chapter">GUI-Applications</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="program-arguments.html"
                        title="next chapter">Evaluating Program Arguments</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="program-arguments.html" title="Evaluating Program Arguments"
             >next</a> |</li>
        <li class="right" >
          <a href="gui-apps.html" title="GUI-Applications"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">ICL Manual</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../extras/tutorial.html" >Tutorials</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2006-2019, Christof Elbrechter, Michael Götting, Robert Haschke, Alexander Neumann.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>