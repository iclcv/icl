#!/usr/bin/make -f

export CPPFLAGS:=$(shell dpkg-buildflags --get CPPFLAGS)
export CFLAGS:=$(shell dpkg-buildflags --get CFLAGS)
export CXXFLAGS:=$(shell dpkg-buildflags --get CXXFLAGS)
export LDFLAGS:=$(shell dpkg-buildflags --get LDFLAGS) -Wl,--as-needed

export CFLAGS+=$(CPPFLAGS)
export CXXFLAGS+=$(CPPFLAGS)

%:
	dh $@ --builddirectory=build --buildsystem=cmake --parallel

override_dh_auto_build:
	dh_auto_build -- doc # Generate Doxygen HTML documentation.

override_dh_auto_configure:
	dh_auto_configure -- \
	cmake	-DCMAKE_SKIP_RPATH=ON \
			-DBUILD_WITH_OPENCV=@BUILD_WITH_OPENCV@ \
			-DBUILD_WITH_QT=@BUILD_WITH_QT@ \
			-DBUILD_WITH_OPENGL=@BUILD_WITH_OPENGL@ \
			-DBUILD_WITH_EIGEN3=@BUILD_WITH_EIGEN3@ \
			-DBUILD_WITH_IMAGEMAGICK=@BUILD_WITH_IMAGEMAGICK@ \
			-DBUILD_WITH_LIBAV=@BUILD_WITH_LIBAV@ \
			-DBUILD_WITH_LIBDC=@BUILD_WITH_LIBDC@ \
			-DBUILD_WITH_LIBFREENECT=@BUILD_WITH_LIBFREENECT@ \
			-DBUILD_WITH_V4L=@BUILD_WITH_V4L@ \
			-DBUILD_WITH_LIBUSB=@BUILD_WITH_LIBUSB@ \
			-DBUILD_WITH_ZMQ=@BUILD_WITH_ZMQ@ \
			-DBUILD_WITH_PYLON=@BUILD_WITH_PYLON@ \
			-DBUILD_WITH_OPENCL=@BUILD_WITH_OPENCL@ \
			-DBUILD_WITH_OPENNI=@BUILD_WITH_OPENNI@ \
			-DBUILD_WITH_PCL=@BUILD_WITH_PCL@ \
			-DBUILD_EXAMPLES=@BUILD_EXAMPLES@ \
			-DBUILD_DEMOS=@BUILD_DEMOS@ \
			-DBUILD_APPS=@BUILD_APPS@ \
			-DBUILD_TESTS=OFF \
			-DBUILD_WITH_IPP=@BUILD_WITH_IPP@ \
			-DBUILD_WITH_MKL=@BUILD_WITH_MKL@ \
			-DBUILD_WITH_XIAPI=@BUILD_WITH_XIAPI@ \
			-DBUILD_WITH_RSC=@BUILD_WITH_RSC@ \
			-DBUILD_WITH_RST=@BUILD_WITH_RST@ \
			-DBUILD_WITH_RSB=@BUILD_WITH_RSB@ \
			-DBUILD_WITH_PROTOBUF=@BUILD_WITH_PROTOBUF@ \
			-DBUILD_WITH_LIBFREENECT2=@BUILD_WITH_LIBFREENECT2@ \
			-DBUILD_WITH_XINE=@BUILD_WITH_XINE@ \
			-DBUILD_WITH_MESASR=@BUILD_WITH_MESASR@ \
			-DBUILD_WITH_LIBIRIMAGER=@BUILD_WITH_LIBIRIMAGER@ \
			-DBUILD_WITH_LIBUDEV=@BUILD_WITH_LIBUDEV@ \
			-DBUILD_WITH_BULLET=@BUILD_WITH_BULLET@ \
			-DBUILD_WITH_BULLET_OPTIONAL=@BUILD_WITH_BULLET@ \
			..
